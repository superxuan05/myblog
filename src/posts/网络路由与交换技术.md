---
cover: /assets/images/cover2.jpg
icon: pen-to-square
date: 2022-01-12
category:
  - 蔬菜
tag:
  - 红
  - 圆
star: true
sticky: true
---

# 网络路由与交换技术
### 1. 路由器配置模式及切换
- **用户模式**：提示符`>`，基础查看权限
- **特权模式**：输入`enable`从用户模式进入，提示符`#`，可查看设备完整配置
- **全局配置模式**：特权模式输入`configure terminal`进入，提示符`(config)#`，可进行全局参数配置

### 2. show命令
| 命令 | 作用 |
|------|------|
| `show running-config` | 查看当前运行配置 |
| `show startup-config` | 查看启动配置（设备重启后生效） |
| `show ip int brief` | 查看接口IP地址及工作状态 |
| `show ip nat tr` | 查看NAT地址转换表 |
| `show arp` | 查看ARP缓存表 |


### 3. 密码配置
- `enable password`：配置明文特权密码（可被直接查看）
- `enable secret`：配置加密特权密码（优先级高于明文密码，可结合MD5加密，同时配置时仅加密密码生效）
### 4. 以太网以及双绞线
- 以太网：10Mbps
- 快速以太网：100Mbps
- 千兆网：1000Mbps
- 同轴电缆(以太网)
- 双绞线
- 五类双绞线（快速以太网）
- 超五类双绞线
- 六类双绞线（千兆网）

### 5. 交换机和路由器
- 交换机和路由器对于cpu/内存的要求都不高
- 一个接口能同时配置多个IP地址和多个Mac地址
- 交换机的多个端口可以一起工作，各各都是独立运行的
- 交换机是提供mac地址表（由mac地址和其对应端口号组成）
- 路由器是提供路由表（由目的IP地址和下一跳IP地址组成）
- 新交换机默认VLAN为VLAN1(native VLAN),在接口软件层面打开的默认都是`no shutdown`（开启）
- 新路由器默认端口默认`shutdown`（关闭）
- 转发器根据目标mac地址转发数据包
- 路由器根据目标ip地址转发数据包
### 6. DHCP协议
- **工作流程 4个包**：Discover（广播 用于寻找服务器）→ Offer（单播 提供可提供的ip地址）→ Request（广播 用于请求分配ip地址）→ ACK（单播 确认分配ip地址）
- 目标MAC为`FF:FF:FF:FF:FF:FF`，目标IP为`255.255.255.255`
### 7. 管理距离（AD）和度量值（Metric）
- 管理距离（AD）：同一路由条目下的不同的协议，**AD值小的协议路由优先**
- 静态路由：1；OSPF：110；EIGRP：90；RIP：120
- 度量值（Metric）：同一路由协议下的不同路径，**度量值小的路径优先**
- rip:以跳数（hop）计算 OSPF:以带宽计算（$\frac{10^8}{链路带宽}$）  
### 7. ARP协议
- 更新计时器（30s）：每30s发送路由器更新
- 无效计时器（180s）：若未收到ARP响应，认为该IP地址不可达
- 抑制计时器（180s）：超时前不接受更差的更新
- 刷新计时器（240s）：超时后彻底删除不可达的路由
- 防止环路：水平分割
    - 简单水平分割：从某接口收到的路由信息，不再从该接口发回（避免路由环路）
    - 带毒性逆转：从某接口收到的路由信息，发回时标记为“不可达”（优点：明确告知邻居该路由无效 可以防止直连的环路）
- rip的两个包：request、response
- rip的距离：16（不可达），15（直接）
- rip的两个版本：RIPv1（有类路由协议 不支持子网掩码）、RIPv2（无类路由协议 支持子网掩码）
### 8. NAT/PAT地址
- NAT
    - 静态NAT：一对一地址映射（固定转换1：1）
    - 动态NAT：多对多地址映射（按需分配不用时候1：m 用的时候是1：1）
- PAT（端口地址转换）：一对多地址映射（通过端口区分 一定是1：m）
### 9. OSPF协议
- 三个表：邻居表、链路状态表、路由表
- 五个包：Hello、DBD、LSR、LSU、LSAck
- 相对于rip ospf全面的好
### 10. 一些工作原理
- PC机的工作原理：如果目标IP与本机IP**同网段**，则直接向目标IP发送ARP请求；如果目标IP与本机IP**不同网段**，则向网关IP发送ARP请求。
- hub的工作原理：接收到数据包，**泛洪**（复制）到所有端口
  -泛洪：将一个数据包从一个端口发送到多个端口，使得数据包在多个端口上可见
- 交换机的工作原理：
  - 包含单播转发、多播转发、广播转发
  - 依据目标IP地址进行转发
  - 纪录原mac地址
- 路由器的工作原理：依据ip地址查表走包
### 11. 静态路由和动态路由的区别
- 静态路由：
    - 手工配置，适用于小型网络，不适用于复杂网络 
    - 不能应对变化，需要手工维护
    - 能精准控制网络
- 动态路由：
    - 自动学习，适用于复杂网络
    - 能自动适应网络变化
    - 控制能力较弱

### 12. 配置代码
-DHCP：
```
1 service dhcp（开启DHCP服务）
2 no ip dhcp conflict logging（关闭DHCP日志信息）
3 ip dhcp excluded-address x.x.x.x（排除地址）
4 ip dhcp pool xxx（创建dhcp地址池）
5 network x.x.x.x x.x.x.x(宣告分配地址网段) 
6 default-router x.x.x.x（设置默认路由，相当于网关）
7 domain-name xxxx.com（设置域名）
8 dns-server x.x.x.x（设置DNS服务器）
9 lease 【infinite | 100】   （设置租期）
10 ip helper-address x.x.x.x (设置DHCP中继语句)
11 show ip dhcp binding 查看DHCP客户端信息
```
Telent：
```
enable
configure terminal
line vty 0 4
transport input telnet
```
OSPF：
```
1 Ospf基本配置；
2 Router(config)#router ospf xx 创建Ospf进程
3 Router(config-router)#router-id x.x.x.x 设置RID
4 Router(config-router)#network x.x.x.x x.x.x.x area x 宣告网段（正反掩码）
5 消除主机路由
6 Router(config-if)#ip ospf network point-to-point 将接口类型改为点到点
7 基于链路的简单口令认证
8 router(config-if)#ip ospf authentication 链路启用简单口令认证 
9 router(config-if)#ip ospf authentication-key xxx 配置认证密码 
10 基于链路的OSPF MD5认证
11 router(config)#interface f0/0
12 router(config-if)#ip ospf authentication message-digest 接口启用MD5认证 
13 router(config-if)#ip ospf message-digest-key 1 md5 xxx 配置key ID及密匙
```
RIP：
```
1 router rip 开启一个Rip进程
2 version 2 指定Rip版本
3 no auto-summary 关闭V2版本自动汇总
4 network x.x.x.x 宣告主网络号
```
NAT：
```
1 静态nat配置： 
2 ip nat inside source static x.x.x.x x.x.x.x （定义静态NAT转换） 
3 Ip nat inside（指定内网接口） 
4 Ip nat outside（指定外网接口）
1 动态nat配置：
2 ip nat pool xx x.x.x.x x.x.x.x netmask x.x.x.x （定义NAT地址池）
3 access-list 1 permit x.x.x.x x.x.x.x （匹配要转换的地址） 
4 ip nat inside source list 1 pool xx（动态NAT转换） 
5 Ip nat inside（指定内网接口） 
6 Ip nat outside（指定外网接口）
```
PAT：
```
1 Pat配置：
2 ip nat inside source list 1 interface  F0/0 overload （定义PAT转换）
3 access-list 1 permit x.x.x.x x.x.x.x （匹配要转换的地址） 
4 Ip nat inside（指定内网接口） 
5 Ip nat outside（指定外网接口）
```
单臂路由：
```
ip route <network-address> <subnet-mask> <next-hop-ip>
```